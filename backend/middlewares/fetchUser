let jwt=require('jsonwebtoken');
const JWT_SECRET=process.env.JWT_SECRET;

const fetchUser=(req,res,next)=>{
    // Reads token sent from client in request headers
  const token=req.header('auth-token');

//   Blocks request if token is missing
  if(!token)
  {
    res.status(401).json({error: "please authenticate using valid token"});
  }
  try {
    // Confirms:Token is genuine, Token not modified, Token not expired
    const data=jwt.verify(token, JWT_SECRET);
    //  Attach user data to request
    req.user=data.user;
    // Move to next middleware / route
    next();
  } catch (error) {
    res.status(401).json({error: "please authenticate using valid token"});
  }
}

module.exports=fetchUser;
